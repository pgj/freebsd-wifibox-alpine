# Maintainer: Gabor Pali <pali.gabor@gmail.com>

pkgname='mDNSResponder'
pkgver=1790.80.10
pkgrel=1
pkgdesc='Bonjour (zero-configuration networking) by Apple'
arch="x86_64"
url='https://opensource.apple.com/tarballs/mDNSResponder/'
license="APACHE-2.0 BSD3"
makedepends="linux-headers musl-nscd-dev mbedtls-dev"
depends=
install=
options="!check !strip"
source="https://github.com/apple-oss-distributions/mDNSResponder/archive/refs/tags/$pkgname-$pkgver.tar.gz
	mdnsresponderposix.initd
	mdnsresponderposix.confd"

_srcdir="$srcdir"/"$pkgname"-"$pkgname"-"$pkgver"
_bins="mDNSResponderPosix"

build() {
	make -j 1 -C "$_srcdir"/mDNSPosix os=linux SAResponder
}

package() {
	mkdir -p \
		"$pkgdir"/usr/bin \
		"$pkgdir"/etc/conf.d \
		"$pkgdir"/etc/init.d
	cd "$_srcdir"/mDNSPosix/build/prod
	for i in $_bins; do
		install -m755 "$i" "$pkgdir"/usr/bin/"$i" || return 1
		strip "$pkgdir"/usr/bin/"$i" || return 1
	done
	cd "$srcdir"
	for i in *.initd; do
		install -m755 "$i" "$pkgdir"/etc/init.d/"${i%.*}" || return 1
	done
	for i in *.confd; do
		install -m644 "$i" "$pkgdir"/etc/conf.d/"${i%.*}" || return 1
	done
}

sha512sums="
3386f2dd7c40a675dbb6518afcd8c26944a32e5d5e52eb16b89d853d0e5d93bdab102a4bdfe486c1719f89fd6a8dd16fb950461d3c75eb822e2817f0cdfa0d17  mDNSResponder-1790.80.10.tar.gz
d2f8359164f4aa1d4c881a5ad4b9a53a44df71ab6c7a57adbeda42cfd7339a7d1f860850df894d9a1f74d1989d012c83733ebfb9a891bdf410cd45fcf47ec1a6  mdnsresponderposix.initd
b53af6a0a1351bd328a54fc8826350340371ad3134fc4131d3a8d1b0e016cf074141a89e515054b2119dc0eff84c609a0b7c422669c3fa00a17d2460140bc24f  mdnsresponderposix.confd
"
