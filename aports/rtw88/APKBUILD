# Maintainer: Gabor Pali <pali.gabor@gmail.com>

pkgname='rtw88'
pkgver=20250905
_kern_maj=6
_kern_min=12
_kern_pcs=48
_kern_rel=0
_drv_rel=0
pkgrel=$(printf "%02d%02d%03d%02d%02d" $_kern_maj $_kern_min $_kern_pcs $_kern_rel $_drv_rel)
_gitrev='bb0ed9d5709afd30e928d2d11f7b650e03c8c72b'
pkgdesc='Backport of the Realtek Wifi 5 drivers from the wireless-next repo'
arch='x86_64'
url='https://github.com/lwfinger/rtw88'
license='GPL-2.0'
makedepends="linux-lts-dev~$_kern_maj.$_kern_min.$_kern_pcs-r$_kern_rel xz"
depends="linux-lts~$_kern_maj.$_kern_min.$_kern_pcs-r$_kern_rel"
install=
options="!check !strip"
source="Makefile.patch
	https://github.com/lwfinger/rtw88/archive/${_gitrev}.zip"

_kver="$_kern_maj.$_kern_min.$_kern_pcs-$_kern_rel-lts"
_kbase="/lib/modules/${_kver}"
_srcdir="$srcdir/rtw88-$_gitrev"
builddir="$_srcdir"

prepare() {
	default_prepare
}

build() {
	make -C "$_srcdir" KVER="$_kver"
}

package() {
	xz "$_srcdir"/*.ko
	install -p -D -m 644 "$_srcdir"/*.ko.xz -t "$pkgdir"/lib/modules/"$_kver"/kernel/drivers/net/wireless/realtek/rtw88 
}

sha512sums="
2434f85ab93657246978a11c08d44a09685f59abe9a44f7a48fef19d0fc679c4564206f23c4d68b78f5d511e9d7d093719dad506e292e286472b459d24bc203d  Makefile.patch
6b2c5247ca528e12b59e518783ed199dab9efe6d496d2d6330e9dd6b76681357da116208c8d7ec3cd6d7fccc778e9709a6683b22a78d891ef664588a74d04e64  bb0ed9d5709afd30e928d2d11f7b650e03c8c72b.zip
"
