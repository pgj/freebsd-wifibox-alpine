# Maintainer: Gabor Pali <pali.gabor@gmail.com>

pkgname='rtw88'
pkgver=20231024
pkgrel=06060220000
_gitrev='ca9f4e199efbf8c377e8a1769ba5b05b23f92c82'
pkgdesc='Backport of the Realtek Wifi 5 drivers from the wireless-next repo'
arch="x86_64"
url='https://github.com/lwfinger/rtw88'
license="GPL-2.0"
makedepends="linux-lts-dev xz"
depends="linux-lts"
install=
options="!check !strip"
source="Makefile.patch
	https://github.com/lwfinger/rtw88/archive/${_gitrev}.zip"

_kver=$(cd /usr/src/ && find . -mindepth 1 -maxdepth 1 -type d -name '*-lts' | sed 's!./linux-headers-!!')
_kbase="/lib/modules/${_kver}"
_srcdir="$srcdir/rtw88-$_gitrev"
builddir="$_srcdir"

prepare() {
	default_prepare
}

build() {
	make -C "$_srcdir" -j8 KVER="$_kver"
}

package() {
	xz "$_srcdir"/*.ko
	install -p -D -m 644 "$_srcdir"/*.ko.xz -t "$pkgdir"/lib/modules/"$_kver"/kernel/drivers/net/wireless/realtek/rtw88 
}

sha512sums="
28dfab87e2768970c572df340e170dc451deb6a2c2cbc817e22f858c8ed627883977a9fffc5a8500e7b5c79bcbd40bc6ce14e45d6741cc9066046aad5e2baabc  Makefile.patch
372e27570739e9d857e187bf39d008801d07aa534ce0db7f1ed5843df0803295d641f623ff4408ef45d26cbb3678f527d01c3e92e4bd2d25d22a6a9f600171ad  ca9f4e199efbf8c377e8a1769ba5b05b23f92c82.zip
"
