# Maintainer: Gabor Pali <pali.gabor@gmail.com>

pkgname='rtw88'
pkgver=20240811
pkgrel=06060470000
_gitrev='a96a433dea8484c3ac252b5a6217467e157b9405'
pkgdesc='Backport of the Realtek Wifi 5 drivers from the wireless-next repo'
arch="x86_64"
url='https://github.com/lwfinger/rtw88'
license="GPL-2.0"
makedepends="linux-lts-dev xz"
depends="linux-lts"
install=
options="!check !strip"
source="Makefile.patch
	https://github.com/lwfinger/rtw88/archive/${_gitrev}.zip"

_kver=$(cd /usr/src/ && find . -mindepth 1 -maxdepth 1 -type d -name '*-lts' | sed 's!./linux-headers-!!')
_kbase="/lib/modules/${_kver}"
_srcdir="$srcdir/rtw88-$_gitrev"
builddir="$_srcdir"

prepare() {
	default_prepare
}

build() {
	make -C "$_srcdir" KVER="$_kver"
}

package() {
	xz "$_srcdir"/*.ko
	install -p -D -m 644 "$_srcdir"/*.ko.xz -t "$pkgdir"/lib/modules/"$_kver"/kernel/drivers/net/wireless/realtek/rtw88 
}

sha512sums="
bf70be19210c93d1215c464eaf7de66a122b4bdf9629fba453be9f6b76cbf801df7e1a5f39ff566695797e2d7bbf0bedf9a75cd077800e88d93d9ebeb2275341  Makefile.patch
0934ac38e76cf278e32d8cfee9e81cd28d8cad661dffe2b0c192cc5bcb9f6a0f6d6db9b2d7d6cc10679375bcca1b08927db21c90f6c19524fb0d24373495bcee  a96a433dea8484c3ac252b5a6217467e157b9405.zip
"
