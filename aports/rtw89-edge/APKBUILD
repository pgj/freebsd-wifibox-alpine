# Maintainer: Gabor Pali <pali.gabor@gmail.com>

pkgname='rtw89-edge'
pkgver=20250827
_kern_maj=6
_kern_min=16
_kern_pcs=8
_kern_rel=0
_drv_rel=0
pkgrel=$(printf "%02d%02d%03d%02d%02d" $_kern_maj $_kern_min $_kern_pcs $_kern_rel $_drv_rel)
_gitrev='8a8ba9bdee85c54b55efa27bd92e6475a77da7af'
pkgdesc='Linux drivers for Realtek Wi-Fi 6/6E and Wi-Fi 7 adapters and cards (edge)'
arch='x86_64'
url='https://github.com/morrownr/rtw89'
license='GPL-2.0'
makedepends="linux-edge-dev~$_kern_maj.$_kern_min.$_kern_pcs-r$_kern_rel xz"
depends="linux-edge~$_kern_maj.$_kern_min.$_kern_pcs-r$_kern_rel"
install=
options="!check !strip"
source="Makefile.patch
	debug.c.patch
	https://github.com/morrownr/rtw89/archive/${_gitrev}.zip"

_kver="$_kern_maj.$_kern_min.$_kern_pcs-$_kern_rel-edge"
_srcdir="$srcdir/rtw89-$_gitrev"
builddir="$_srcdir"

prepare() {
  default_prepare
  sed -i -E 's/_git//g' "$_srcdir"/Makefile
}

build() {
  make -C "$_srcdir" KVER="$_kver"
}

package() {
  xz "$_srcdir"/*.ko
  install -p -D -m 644 "$_srcdir"/*.ko.xz -t "$pkgdir"/lib/modules/"$_kver"/kernel/drivers/net/wireless/realtek/rtw89
}

sha512sums="
d4ba10a433894026d0aee92766285fc98247296d8ece3531760f41ce3d4fb09c8a10efc6a4b646da1061ca07c23935d74120cce07b1cb7408f76205ed51fa1db  Makefile.patch
dde8f7102ccaf8060e0c29832590a026230cb4a0d6c8eac196afdd856d30e86908f3a6f6423fad2197b952792265e1c2c3d50aa3e8c96bf6b109c5240e33e12b  debug.c.patch
911cf7cb242e6c1c38596661d9f802c5fd2416db8fa0497caa8b192340b7c3e881c137b84ae33842d9cb2037fbfccb9df159ea02117ad12ec5254e1f9d19f7b1  8a8ba9bdee85c54b55efa27bd92e6475a77da7af.zip
"
