--- a/debug.c
+++ b/debug.c
@@ -233,7 +233,7 @@
 	return debugfs_priv->cb_write(rtwdev, debugfs_priv, buf, count);
 }
 
-#if LINUX_VERSION_CODE >= KERNEL_VERSION(6, 13, 0)
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(6, 13, 0) && defined(CONFIG_DEBUG_FS)
 static const struct debugfs_short_fops file_ops_single_r = {
 	.read = rtw89_debugfs_file_read,
 	.llseek = generic_file_llseek,
